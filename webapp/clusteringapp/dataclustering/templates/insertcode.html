{% extends "base.html" %}

{% block title %}
Insert Code
{% endblock %}

{% block nav-insertcode %}
class="active"
{% endblock %}

{% block content %}

<article>
	<section>
		<h2>  Insert Code </h2>
			<div class="codeInsertion">
				<form role="form" class="">
					<div class="form-group">
					<label for="codeInput">Kluster Code:</label>
		                <input class="form-control" id="codeInput"/>
		            </div>

		            <div class="form-group">
						<button id="insertCodeButton" type="submit" class="btn btn-primary" onclick="showcode()">Get Kluster</button>
					</div>

					<script>
						function httpGet(theUrl)
							{
							    var xmlHttp = null;

							    xmlHttp = new XMLHttpRequest();
							    xmlHttp.open( "GET", theUrl, false );
							    xmlHttp.send( null );
							    return xmlHttp.responseText;
							}
						function showcode() {
							var klusterCode = document.getElementById("codeInput").value;
							var baseURL = "http://localhost:8000/getjsonfromcode?code=";
							var requestUrl = baseURL.concat(klusterCode);
							var jsonCode = httpGet(requestUrl);
							displayKluster(jsonCode);
							event.preventDefault();
						}

					</script>
				</form>
			</div>
				<div class="klusterView" id="dendrogram">
					<script>
					
						function displayKluster(jsonCode) {
							var hr = document.createElement("hr");
					document.getElementById('dendrogram').appendChild(hr);
							var width = 960,
    height = 700;
var cluster = d3.layout.cluster()
    .size([height, width - 100]);
var diagonal = d3.svg.diagonal()
    .projection(function(d) { return [x(d.y), d.x]; });
var svg = d3.select("#dendrogram").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(50,40)");
var xs = [];   
var ys = [];   
function getXYfromJSONTree(node){           
   xs.push(node.x);          
   ys.push(node.y);           
   if(typeof node.children != 'undefined'){                   
      for ( j in node.children){                           
         getXYfromJSONTree(node.children[j]);                   
      }           
   }   
}   
var ymax = Number.MIN_VALUE;   
var ymin = Number.MAX_VALUE;   

   var root = JSON.parse(jsonCode);
   getXYfromJSONTree(root);
  var nodes = cluster.nodes(root),
      links = cluster.links(nodes);
   nodes.forEach( function(d,i){                   
      if(typeof xs[i] != 'undefined'){                           
         d.x = xs[i];                   
      }                   
      if(typeof ys[i] != 'undefined'){                           
         d.y = ys[i];                   
      }           
   });           
   nodes.forEach( function(d){                   
      if(d.y > ymax)
         ymax = d.y;
      if(d.y < ymin)                           
         ymin = d.y;           
   });           
   x = d3.scale.linear().domain([ymin, ymax]).range([0, width-100]);           
   xinv = d3.scale.linear().domain([ymax, ymin]).range([0, width-100]);   
  var link = svg.selectAll(".link")
      .data(links)
    .enter().append("path")
      .attr("class", "link")
      .attr("d", diagonal);
  var node = svg.selectAll(".node")
      .data(nodes)
    .enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { return "translate(" + x(d.y) + "," + d.x + ")"; })
  node.append("circle")
      .attr("r", 4.5);
  node.append("text")
      .attr("dx", function(d) { return d.children ? -8 : 8; })
      .attr("dy", 3)
      .style("text-anchor", function(d) { return d.children ? "end" : "start"; })
      .text(function(d) { return d.name; });   

						}
					</script>
				</div>

	</section>
</article>

{% endblock %}

{% block footer %}

{% endblock %}
